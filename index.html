<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HL万圣节趣味单（远程观看版）</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入LeanCloud SDK（实时数据库） -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.17.0/dist/av-min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#EC4899',
                        accent: '#FBBF24',
                        danger: '#EF4444',
                        light: '#F3F4F6',
                        dark: '#1F2937',
                        spectator: '#3B82F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'celebrate': 'celebrate 0.5s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        celebrate: {
                            '0%': { transform: 'scale(1)' },
                            '100%': { transform: 'scale(1.2)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .square-active {
                border: 2px solid #FBBF24;
                box-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
            }
            .gradient-card {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .mode-active {
                border-color: #FBBF24;
                background-color: rgba(251, 191, 36, 0.2);
                box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            }
            .spectator-badge {
                background-color: rgba(59, 130, 246, 0.2);
                border: 1px solid rgba(59, 130, 246, 0.4);
            }
        }
    </style>
    
    <style>
        body {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(10px);
        }
        
        .square {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            border-radius: 0.75rem;
            position: relative;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        
        .square:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .square.current {
            background-color: #FBBF24;
            color: #1F2937;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.7);
            z-index: 5;
        }
        
        .player {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            z-index: 10;
            transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            top: 24px;
            right: 24px;
        }
        
        .player-1 {
            background-color: #EF4444;
        }
        
        .item-marker {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background-color: #FBBF24;
            color: #1F2937;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            z-index: 8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .item-marker:hover + .item-tooltip {
            display: block;
        }
        
        .item-tooltip {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1F2937;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 15;
            display: none;
        }
        
        #move-button, #start-game, #next-to-items, #next-to-game {
            background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%);
        }
        
        #move-button:hover, #start-game:hover, #next-to-items:hover, #next-to-game:hover {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }
        
        .item-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .item-active {
            border: 2px solid #FBBF24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.7);
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall 3s linear forwards;
            z-index: 100;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh);
                opacity: 0;
            }
        }
        
        .intro-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .intro-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .mode-btn {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stage-container {
            display: none;
        }
        
        .stage-container.active {
            display: block;
        }
        
        .spectator-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 10px 15px;
            border-radius: 20px;
            color: #3B82F6;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .spectator-mode .interactive-element {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .share-link-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .share-link {
            flex-grow: 1;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            font-size: 0.875rem;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* 同步状态指示器 */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            z-index: 999;
        }
        
        .sync-status.connected {
            background-color: rgba(0, 255, 0, 0.5);
        }
        
        .sync-status.disconnected {
            background-color: rgba(255, 0, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen font-sans text-dark">
    <!-- 同步状态指示器 -->
    <div id="sync-status" class="sync-status">
        <i class="fa fa-circle-o-notch fa-spin mr-1"></i> 连接云端中...
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- 页面标题 -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white flex items-center">
                <i class="fa fa-pumpkin-o mr-3 text-accent"></i>HL万圣节趣味单
            </h1>
            <!-- 角色选择 -->
            <div class="flex gap-3">
                <button id="play-as-player" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg flex items-center backdrop-blur-sm interactive-element">
                    <i class="fa fa-user mr-2"></i> 玩家
                </button>
                <button id="play-as-spectator" class="bg-spectator/20 hover:bg-spectator/30 text-spectator px-4 py-2 rounded-lg flex items-center backdrop-blur-sm interactive-element">
                    <i class="fa fa-eye mr-2"></i> 观众
                </button>
            </div>
        </div>
        
        <!-- 分享链接区域 -->
        <div id="share-section" class="max-w-md mx-auto mb-6 bg-white/20 rounded-xl p-4 backdrop-blur-md hidden">
            <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-white">分享游戏（远程观看）</span>
                <span class="text-xs text-white/70">他人可通过链接远程观看</span>
            </div>
            <div class="share-link-container">
                <input type="text" id="game-share-link" class="share-link" readonly>
                <button id="copy-share-link" class="bg-white/30 hover:bg-white/40 text-white p-2 rounded-lg interactive-element">
                    <i class="fa fa-copy"></i>
                </button>
            </div>
        </div>
        
        <!-- 操作提示 -->
        <p class="text-center text-white/90 mb-6 text-lg" id="stage-instruction">选择游戏难度，开始你的万圣节趣味之旅！</p>
        
        <!-- 第一阶段：模式选择 -->
        <div id="mode-selection-stage" class="stage-container active">
            <!-- 游戏介绍 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="intro-card gradient-card rounded-xl p-6 text-white">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-gamepad text-2xl text-accent"></i>
                        </div>
                        <h3 class="text-xl font-bold">趣味玩法</h3>
                    </div>
                    <ul class="space-y-2 text-white/90">
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>前进条件:双打手总计人头数1个可以前进一格</span></li>
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>后退条件:摸到1-2格红退1步，4格退2步，6格退3步</span></li>
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>撤退失败的红计入打手人头，不计后退步数</span></li>
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>摸到特殊格子后退6步</span></li>
                    </ul>
                </div>
                <div class="intro-card gradient-card rounded-xl p-6 text-white">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-gift text-2xl text-accent"></i>
                        </div>
                        <h3 class="text-xl font-bold">道具系统</h3>
                    </div>
                    <ul class="space-y-2 text-white/90">
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>共9张道具卡，可自由选择</span></li>
                        <li class="flex items-start"><i class="fa fa-check-circle text-accent mt-1 mr-2"></i><span>普通版选3张，困难版选6张</span></li>
                        <li class="flex items-start"><i